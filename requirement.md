# Gemini OCR Capture 要件定義

**概要:**

マウスドラッグで指定した画面領域をキャプチャし、Gemini API を利用して OCR (光学文字認識) を行い、その結果をクリップボードにコピーする、シングルバイナリのWindowsデスクトップアプリケーション。 C# で開発し、設定ファイルは実行ファイルと同じディレクトリに保存する。

**1. ゴール:**

*   ユーザーが手軽に画面上の文字情報をテキストデータとして取得できるようにする。
*   Gemini API の OCR 機能を活用し、高精度な文字認識を実現する。
*   シンプルな操作で迅速に結果を得られるようにする。

**2. 機能要件:**

*   **基本動作フロー:**
    *   起動時に即座に画面キャプチャモードへ移行
    *   キャプチャ実行またはキャンセル選択
    *   OCR処理実行
    *   結果をクリップボードへコピー
    *   処理完了後は自動的に終了
    *   エラー発生時はログ出力とトースト通知を行い終了

*   **画面キャプチャ:**
    *   マウスドラッグによる範囲指定キャプチャ
        *   ドラッグ開始地点と終了地点を視覚的に表示する（矩形など）。
        *   フルスクリーンキャプチャモード（オプション）。
    *   キャプチャ範囲の選択をキャンセルする機能（Escキーなど）。
    *   視覚的フィードバック：
        *   半透明の黒色オーバーレイ表示
        *   3pxの緑色の枠線表示
        *   選択範囲のサイズ情報表示
*   **Gemini API連携:**
    *   キャプチャ画像を Gemini API に送信し、OCR を実行。
    *   APIキーの設定機能 (初回起動時または設定画面)。
    *   APIエラー時のエラーハンドリングとユーザーへの通知：
        *   Windows標準のトースト通知を使用
        *   エラー種別（認証エラー、ネットワークエラー、OCR失敗）の明確な表示
        *   エラーログを実行ファイルと同一ディレクトリの error.log に出力
        *   ログ形式：タイムスタンプ、エラー種別、詳細メッセージ
*   **OCR結果の処理:**
    *   OCR 結果をクリップボードにコピー。
    *   OCR 結果をツール上に表示するオプション (設定でON/OFF可能)。
*   **設定:**
    *   Gemini API キーの設定。
        *   `System.Security.Cryptography` を使用して、APIキーを暗号化してファイルに保存する。
    *   OCR 結果の表示設定 (ツール上に表示するか否か)。
    *   言語設定 (Gemini API に渡す言語ヒント)。
    *   フルスクリーンキャプチャのショートカットキー設定 (デフォルト: PrintScreen)。
    *   **設定ファイルパス:** 実行ファイルと同じディレクトリに `config.json` として保存する。
*   **その他:**
    *   シングルバイナリで配布可能であること。
    *   Windows 10以上で動作保証すること。

**3. 非機能要件:**

*   **パフォーマンス:**
    *   キャプチャから OCR 処理完了までの時間を短縮する (目標: 5秒以内)。
    *   高解像度な画像でも安定して動作すること。
*   **ユーザビリティ:**
    *   直感的で分かりやすいインターフェース。
    *   最小限の操作で目的を達成できること。
    *   エラー発生時に適切なメッセージを表示すること。
*   **セキュリティ:**
    *   API キーを安全に保存する (暗号化など)。
        *   `ProtectedData.Protect` / `ProtectedData.Unprotect` を使用して、ユーザーの資格情報に基づいて暗号化する。
    *   通信経路の暗号化 (HTTPS)。
*   **保守性:**
    *   コードの可読性・保守性を高める。
    *   設定ファイルによる柔軟な設定変更を可能にする。

**4. 画面設計:**

*   **メイン画面:**
    *   キャプチャ開始ボタン (またはショートカットキー)。
    *   設定ボタン。
    *   OCR結果表示エリア (オプション)。
*   **設定画面:**
    *   Gemini API キー入力欄。
    *   各種設定項目 (チェックボックス、ドロップダウンリストなど)。

**5. データ設計:**

*   **設定ファイル (config.json):**

    
json
    {
      "ApiKey": "暗号化されたAPIキー",
      "DisplayOcrResult": true,
      "Language": "ja",
      "FullscreenShortcut": "PrintScreen"
    }
    *   `ApiKey`: 暗号化された Gemini API キー。
    *   `DisplayOcrResult`: OCR 結果をツール上に表示するか否か (true/false)。
    *   `Language`: Gemini API に渡す言語ヒント (例: "ja", "en")。
    *   `FullscreenShortcut`: フルスクリーンキャプチャのショートカットキー。

**6. インターフェース設計:**

*   **Gemini API:**
    *   Gemini API の Text and Image 入力に対応したAPIエンドポイントを使用。
    *   APIキーによる認証。

**7. テスト計画:**

*   **単体テスト:**
    *   各機能モジュールが正しく動作することを確認。
*   **結合テスト:**
    *   各機能モジュール間の連携が正しく動作することを確認。
*   **システムテスト:**
    *   全体を通して要件を満たしているか確認。
*   **受け入れテスト:**
    *   ユーザーが実際に使用して、使い勝手や機能を確認。

**8. その他:**

*   利用規約およびプライバシーポリシーの明記。
*   Gemini API の利用規約を遵守すること。

**9. 今後の拡張:**

*   OCR 結果の編集機能。
*   複数の Gemini API モデルの選択。
*   キャプチャ画像の保存機能。
*   他のクラウドストレージサービスとの連携。
